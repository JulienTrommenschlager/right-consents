---
title: Records & Receipts
permalink: /docs/records-receipts/
excerpt: "What are the caracteristics and the differences between Records and Receipts"
last_modified_at: 2020-12-28
toc: true
---

Right Consent generates two types of output : Consent Record and Consent Receipt.

## Consent Record

![Record Anatomy](/right-consents/assets/images/record-anatomy.png)

Consent Record are designed to **store the answers** of a subject regarding consent or preference. The goal is to **create a ground truth** (more or less like a access control list) that will be queried when needed. It has to give **very fast query results** and to avoid locks during creation to allows a **good througput in writing** new values.

Consent Record are **stored atomically**. That means that if a Consent Form holds 6 elements (2 processing and 4 preferences), 6 records will be generated within **the same transaction id**. This atomicity allows to retrieve a value for a specific element key or serial and to evaluate this value in another form composition (aka with different elements displayed).

Consent Record takes into consideration answers given for a **specific model version**, ensuring that new MAJOR model versions will be able to have an **impact on previous records**. This is done using serial numbers more than model keys. A global serial number is generated by combining the serial number of basic information model displayed in the form and the serial number of element consented. If any of those two serial numbers is no more valid in a query, all records with that serial will be evaluated as invalid.

Consent Record **stores the value** given by the subject for that particular element. Depending on the element type it can be a boolean, a string or a list of string.

Finally, it **keeps track** of the context by storing extra informations like author, attributes or even a comment.

**Status validity** of a record is **NOT stored** in the base to avoid complex updates. It is a transient information **evaluated at runtime**. The evaluation algorithm uses a query context to extract relevant records and then **applies a set of specific rules** to determine a status : *VALID, OBSOLETE, EXPIRED, IRRELEVANT, UNKNOWN*. Business rules can be **customized**. Evaluation status can then differ if query context is not the same, even for a single element.

Consent Record storage is designed to be **performant in writing** but also **performant at evaluation time**. It is stored in a single table but specific index (and sharding) strategies are possibles in that objective.

## Consent Receipt

Consent Receipt are **unique for a single transaction**. There is a one to many assocation between the Consent Receipt and the Consent Record. Consent Receipt is the proof that consent has been collected in a conform way.

Consent Receipt are designed to act more or less **like any classic receipt**. It is a single document that **holds informations** on choices made at a particular time and into a specific context and conditions between a subject and a data controller. That document should be **opposable** to any counterparts in case of conflict or in any needs to change choices.

Consent Receipt have to **be portable* and to allow its holder to use it at any moment to **express any changes**. That's why it also holds a link to an online form with a valid context allowing to retrieve the previoulsy given values and to change any of them.

Consent Receipt also have to follow existings and upcoming **standards** : [ISO/IEC 29184:2020](https://www.iso.org/standard/70331.html) [ISO/IEC WD TS 27560](https://www.iso.org/standard/80392.html). 

Consent Receipt should also be **interoperable** by providing an **abstract query system**. We plan to expose all consent receipt as **XACML Policies** allowing XACML Queries to be propagated along Right Consent existing instances in order to provide a **consistent result over multiple actors**.

Consent Receipt uses **XML format** but can also be transformed in a **PDF document** using classic XSL stylesheets. The XML format is retained for its **portability in machine to machine communications** where the PDF format is intresting for **human to human interactions**. Both format can be timestamped or signed to **reinforce intention** of counterparts and to add a real proof level with technologies like [XAdES](https://www.w3.org/TR/XAdES/) and PAdES. 

Finally, signature of consent receipt (or its pdf attachment) can **condition the state** of associated records, waiting for the signature to be effective in order **commit transaction** and pass state of records from PENDING to COMMITTED. This 2FC mecanism aims to allow long time validation process. The signature can also be a simple handwriten mark made on a tablet or a an audio record of approbation because anh type of data can be inserted as attachment of a receipt.

